<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="TaskFlowAccountMapper">
    <resultMap id="AccountWithRoleDateInfoResultMap"
               type="com.example.TaskFlow.model.response.account.TaskAccountResponse">
        <!-- GDPMS_ACCOUNT (ga) -->
        <result property="loginId" column="login_id"/>
        <result property="password" column="password"/>
        <result property="name" column="name"/>
        <!--        <result property="companyName" column="company_name" />-->
        <result property="roleCode" column="role_code"/>
        <result property="lastLoginAt" column="last_login_at"/>
        <result property="status" column="status"/>
        <result property="phone" column="phone"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <sql id="accountInfoColumns">
        u.id,
        u.login_id,
        u.password,
        u.name,
        u.phone,
        u.role_code,
        u.status,
        u.last_login_at,
        u.created_at,
        u.updated_at
    </sql>

    <select id="selectAccountById" parameterType="string" resultMap="AccountWithRoleDateInfoResultMap">
        SELECT
        <include refid="accountInfoColumns"/>
        FROM users u
        WHERE u.login_id = #{accountId}
    </select>

    <select id="existsByLoginId" parameterType="string" resultType="boolean">
        SELECT CASE WHEN EXISTS(
        SELECT 1 FROM users WHERE login_id = #{accountId}
        ) THEN 1 ELSE 0 END
    </select>

    <insert id="insertAccount" parameterType="map">
        INSERT INTO users (login_id, password, name, phone, role_code, status)
        VALUES (#{loginId}, #{password}, #{name}, #{phone}, #{roleCode}, 'ACTIVE')
    </insert>


    <!--    <select id="selectAccountByIds" parameterType="list" resultMap="AccountWithRoleDateInfoResultMap">-->
    <!--        SELECT-->
    <!--        <include refid="accountInfoColumns"/>,-->
    <!--        sui.email-->
    <!--        FROM GDPMS_ACCOUNT ga-->
    <!--        LEFT JOIN SDK_USER_INFO sui-->
    <!--        ON ga.company_code = sui.company_code-->
    <!--        AND ga.origin_user_id = sui.user_id-->
    <!--        <where>-->
    <!--            <if test="list != null and list.size() > 0">-->
    <!--                ga.gdpms_account_id IN-->
    <!--                <foreach collection="list" item="id" open="(" separator="," close=")">-->
    <!--                    #{id}-->
    <!--                </foreach>-->
    <!--            </if>-->
    <!--        </where>-->
    <!--    </select>-->
</mapper>